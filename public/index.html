<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>InFormer – DIY Legal Kits</title>
  <meta name="description" content="State-specific DIY legal kits with clear, step-by-step instructions." />

  <link rel="stylesheet" href="/styles.css" />

  <!-- SEO / Social -->
  <meta property="og:title" content="InFormer – DIY Legal Kits" />
  <meta property="og:description" content="State-specific DIY legal kits with clear, step-by-step instructions." />
  <meta property="og:type" content="website" />
</head>

<body>

  <!-- HEADER -->
  <header class="hdr">
    <a href="/" class="logo">
      <img src="/informer-logo.png" alt="InFormer" height="42" />
    </a>

    <input
      class="search"
      id="q"
      type="search"
      placeholder="Search kits (state, children, title)"
      aria-label="Search kits"
    />
  </header>

  <!-- MAIN -->
  <main class="wrap">
    <section id="products" class="grid">
      <!-- product cards render here -->
    </section>
  </main>

  <!-- SCRIPT -->
  <script>
    const $ = (s) => document.querySelector(s);

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function normalize(s) {
      return String(s || "").toLowerCase();
    }

    function coverFromProduct(p) {
      if (p.CoverImageURL && p.CoverImageURL.trim()) {
        return p.CoverImageURL.trim();
      }

      const sku = String(p.SKU || "").trim().toUpperCase();
      const m = sku.match(^INF-([A-Z]{2})-(WC|NC)1000 1000;

      if (m) {
        const state = m[1];
        const type = m[2] === "WC" ? "WithChildren" : "NoChildren";
        return `/kits/${state}_${type}_CoverPhoto_v2.png`;
      }

      return "/placeholder.svg";
    }

    function searchFilter(p, q) {
      if (!q) return true;
      return [
        p.Title,
        p.State,
        p.Subcategory,
        p.ChildrenStatus,
        p.Tags,
        p.SKU
      ]
        .map(normalize)
        .join(" ")
        .includes(q);
    }

    function cardHTML(p) {
      const cover = coverFromProduct(p);

      return `
        <article class="card">
          <img
            class="card-cover"
            src="${cover}"
            alt="${escapeHtml(p.Title)}"
            loading="lazy"
            onerror="this.src='/placeholder.svg'"
          />
          <div class="card-body">
            <div class="card-meta">
              <span class="price">$${p.PriceUSD}</span>
              <span class="badge">${escapeHtml(p.ChildrenStatus)}</span>
            </div>
            <h3>${escapeHtml(p.Title)}</h3>
            <p>${escapeHtml(p.ShortDescription)}</p>
          </div>
        </article>
      `;
    }

    async function init() {
      const grid = $("#products");
      const q = $("#q");

      try {
        const res = await fetch("/products.json", { cache: "no-store" });
        const products = await res.json();

        function render() {
          const query = normalize(q.value).trim();
          grid.innerHTML = products
            .filter(p => searchFilter(p, query))
            .map(cardHTML)
            .join("") || "<p>No kits found.</p>";
        }

        q.addEventListener("input", render);
        render();
      } catch (e) {
        console.error(e);
        grid.innerHTML = "<p>Failed to load products.</p>";
      }
    }

    init();
  </script>

  <div id="grid" class="grid"></div></body>
</html>